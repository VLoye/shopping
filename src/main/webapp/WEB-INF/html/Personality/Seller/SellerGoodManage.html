<!--商品管理-->
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="renderer" content="webkit|ie-stand" />
    <meta charset="utf-8" />
    <title>汽配人-我的旺铺</title>

    <link href="static/css/css_base.css" rel="stylesheet" />
    <link href="static/css/css_top.css" rel="stylesheet" />
    <link href="static/css/hayui.css" rel="stylesheet" />
    <link href="static/css/leagueradmin-nav-sidemenu.css" rel="stylesheet" />
    
    <script src="static/js/jquery-3.3.1.min.js" type="text/javascript"></script>
    <script src="static/js/jquery.cookie.js" type="text/javascript"></script>
    <script src="static/js/hayui.js" type="text/javascript"></script>
    <script type="text/javascript">
        var globals = { sys_applicationname: '/work' };
        function qpr_skip() {
            var options = { path: "/" };
            $.cookie('qpr_h_flag', '1', options);
            location.href = globals.sys_applicationname;
        }
        function mall_skip() {
            var options = { path: "/" };
            $.cookie('qpr_h_flag', '2', options);
            location.href = "http://mall.qipeiren.com/selleradmin/home";
        }
        $(function () {$("#headTopNav").load("http://www.qipeiren.com/c/TShare/HeadTopLink?headcrror=true");});
    </script>
    
</head>
<body class="hayui-bg-gray-light">

<div class="hayui-tab hayui-bg-white hayui-p10" hay-filter="tabcard">
    <ul class="hayui-tab-title">
        <li class=hayui-this>
            <a href="http://127.0.0.1:8020/shopping/html/infolist.html">供应信息</a>
        </li>
        <li class=>
            <a href="http://127.0.0.1:8020/shopping/html/infolist.html?infoType=3">库存促销</a>
        </li>
        <li class=>
            <a href="http://127.0.0.1:8020/shopping/html/infolist.html?infoType=4">加工合作</a>
        </li>
        <li class=>
            <a href="http://127.0.0.1:8020/shopping/html/infolist.html?infoType=2">求购信息</a>
        </li>
        <li>
            <a data-tag="false" data-type="push">企业公告</a>
        </li>
    </ul>
    <div class="hayui-tab-content">
        <div class="hayui-tab-item hayui-show">
            <form class="hayui-form hayui-mt10" hay-filter="form-search" id="form-search">
                <div class="hayui-form-item">
                        <div class="hayui-inline">
                            <label class="hayui-form-label">图号 / 名称</label>
                            <div class="hayui-input-block">
                                <input type="text" name="proname" autocomplete="off" placeholder="请输入图号 / 名称" class="hayui-input hayui-w150">
                            </div>
                        </div>
                        <div class="hayui-inline">
                            <label class="hayui-form-label">产品星级</label>
                            <div class="hayui-input-inline hayui-w150">
                                <select name="prostar" hay-search="search">
                                    <option value="0"></option>
                                    <option value="5">5星</option>
                                    <option value="4">4星</option>
                                    <option value="3">3星</option>
                                    <option value="2">2星</option>
                                    <option value="1">1星</option>
                                </select>
                            </div>
                        </div>
                        <div class="hayui-inline">
                            <label class="hayui-form-label">自定义分类</label>
                            <div class="hayui-input-inline hayui-w150">
                                <select name="cid" hay-search="search" data-value="-1_0">
                                    <option value="-1_0">按分类查看产品</option>
                                        <option value="92181_1">123</option>
                                        <option value="92025_0">aaaa</option>
                                        <option value="92026_1">　　hhh</option>
                                        <option value="92177_1">　　6546546</option>
                                        <option value="92027_0">bbb</option>
                                        <option value="92028_1">　　cccc</option>
                                </select>
                            </div>
                        </div>
                        <div class="hayui-inline">
                            <label class="hayui-form-label">价格区间</label>
                            <div class="hayui-input-inline hayui-form-range">
                                <input type="text" name="jg_s" placeholder="￥" autocomplete="off" class="hayui-input hayui-fl hayui-w60" onkeyup="value=value.replace(/[^\d.]/g, '').replace(/^\./g,'').replace(/\.{2,}/g, '.').replace('.', '$#$').replace(/\./g, '').replace('$#$', '.')" maxlength="7">
                                <div class=" hayui-form-mid hayui-fl hayui-ml15 hayui-mr10">-</div>
                                <input type="text" name="jg_e" placeholder="￥" autocomplete="off" class="hayui-input hayui-fl hayui-w60" onkeyup="value=value.replace(/[^\d.]/g, '').replace(/^\./g,'').replace(/\.{2,}/g, '.').replace('.', '$#$').replace(/\./g, '').replace('$#$', '.')" maxlength="7">
                            </div>
                        </div>

                        <div class="hayui-inline">
                            <label class="hayui-form-label">在线订购</label>
                            <div class="hayui-input-inline hayui-w150">
                                <select name="zxdg" hay-filter="aihao">
                                    <option value=""></option>
                                    <option value="zc">支持</option>
                                    <option value="bzc">不支持</option>
                                </select>
                            </div>
                        </div>
                        <div class="hayui-inline">
                            <label class="hayui-form-label">产品状态</label>
                            <div class="hayui-input-inline hayui-w150">
                                <select name="cpzt" hay-filter="aihao">
                                    <option value=""></option>
                                    <option value="0">未分类产品</option>
                                    <option value="ds">待审核</option>
                                    <option value="sh">未通过审核</option>
                                    <option value="xj">违规下架</option>
                                </select>
                            </div>
                        </div>
                        <div class="hayui-inline">
                            <label class="hayui-form-label">车型筛选</label>
                            <div class="hayui-input-inline hayui-w150">
                                <select name="cxsx" hay-filter="aihao">
                                    <option value=""></option>
                                    <option value="cx">支持</option>
                                    <option value="ncx">不支持</option>
                                </select>
                            </div>
                        </div>
                        <div class="hayui-inline">
                            <label class="hayui-form-label">授权品牌</label>
                            <div class="hayui-input-inline hayui-w150">
                                <select name="sqpp" hay-filter="aihao">
                                    <option value=""></option>
                                    <option value="pp">有授权</option>
                                    <option value="npp">无授权</option>
                                </select>
                            </div>
                        </div>
                    </div>
                <div class="hayui-form-item">
                    <div class="hayui-row hayui-text-align-r">
                        <span class="hayui-btn  hayui-btn-small" hay-batch="btn" data-type="dosearch">搜索</span>
                        <span type="reset" class="hayui-btn hayui-btn-primary hayui-btn-small" hay-batch="btn" data-type="reset">重置</span>
                    </div>
                </div>
            </form>
            <div class="hayui-inline">
                <button class="hayui-btn hayui-btn-primary hayui-btn-small" data-type="batchtemp" hay-batch="btn">关联版式</button>
                <button class="hayui-btn hayui-btn-primary hayui-btn-small" data-type="batchsave" hay-batch="btn">追加自定义分类</button>
                <button class="hayui-btn hayui-btn-primary hayui-btn-small" data-type="batchdel" hay-batch="btn">删除</button>
                <button class="hayui-btn hayui-btn-primary hayui-btn-small" data-type="batchShangJia" hay-batch="btn">申请上架</button>
            </div>
            <table class="hayui-table" id="productSupply" hay-filter="productSupply"></table>

            <!--修改产品价格-->
            <form class="hayui-form hayui-mt10 hayui-shide" id="update_wprice_from">
                <div class="hayui-form-item">
                    <div class="hayui-inline">
                        <label class="hayui-form-label">成交价格：</label>
                        <div class="hayui-input-block">
                            <input type="text" name="wprice" id="wprice" hay-verify="required" autocomplete="off" placeholder="价格" onpaste="return false" onkeyup="value=value.replace(/[^\d.]/g, '').replace(/^\./g,'').replace(/\.{2,}/g, '.').replace('.', '$#$').replace(/\./g, '').replace('$#$', '.')" class="hayui-input hayui-w250" value="">
                        </div>
                    </div>
                    <div class="hayui-inline">
                        <label class="hayui-form-label">运费设置：</label>
                        <div class="hayui-input-block">
                            <select name="yunfei" id="yunfei" hayui-filter="yunfei">
                                <option value="1">运费待定（买卖双方协商）</option>
                                <option value="2">卖家承担运费</option>
                                <option value="3">买家运费到付</option>
                            </select>
                        </div>
                    </div>
                </div>
            </form>

            <!--批量修改产品分类-->
            <form class="hayui-form hayui-mt10" style="display:none;" id="update_proclass_from">
                <div class="hayui-form-item">
                    <div class="hayui-inline">
                        <label class="hayui-form-label">选择分类：</label>
                        <div class="hayui-input-block">
                            <select name="user_cid" id="user_cid" hay-optgroupsel="" hay-search="search">
                                <option value="-1">按分类查看产品</option>
                                    <option  value="92181">123</option>
                                    <option disabled='' value="92025">aaaa</option>
                                    <option  value="92026">　　hhh</option>
                                    <option  value="92177">　　6546546</option>
                                    <option disabled='' value="92027">bbb</option>
                                    <option  value="92028">　　cccc</option>
                            </select>

                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="hayui-helptip hayui-bg-white hayui-mt20">
    <div class="hayui-helptip-cont">
        <i class="helptip-tipicon hayui-icon hayui-icon-tip hayui-color-normal"></i>
        <label class="helptip-title">【信息管理小贴士】</label>
        <div class="helptip-indent">
            <span class="helptip-desc"><b class="hayui-fw-blod">修改：</b> 完善信息内容，提高信息质量；信息质量越高，越能吸引买家。</span>
        </div>
    </div>
</div>
<div class="hayui-helptip hayui-bg-white">
    <div class="hayui-helptip-cont">
        <i class="helptip-tipicon hayui-icon hayui-icon-tip3 hayui-color-danger hayui-fs-18"></i>
        <label class="helptip-title">【温馨提示】</label>
        <div class="helptip-indent">
            <span class="helptip-desc">1、请您务必确认您所发的信息真实、合法、准确、及时，未侵犯他人合法权利，以免导致不必要的纠纷！</span>
            <br>
            <span class="helptip-desc">2、对于已发布上网的信息，汽配人仍将保留复查的权力。一旦发现问题，该信息将会从网上撤出！</span>
        </div>

    </div>
</div>


<!--关联版式-->
<form class="hayui-form hayui-mt10" style="display:none;" id="add_template" hay-filter="add_template">
    <div class="hayui-form-item hayui-mt10">
        <div class="hayui-inline">
            <label class="hayui-form-label">顶部 </label>
            <div class="hayui-input-inline">
                <select name="top_tmp" id="top_tmp" hayui-filter="top_tmp">
                    <option value="0">顶部模板（请选择）</option>
                </select>
                </div>
            </div>
        </div>
    <div class="hayui-form-item hayui-mt10">
        <div class="hayui-inline">
            <label class="hayui-form-label">底部 </label>
            <div class="hayui-input-inline">
                <select name="bot_tmp" id="bot_tmp" hayui-filter="bot_tmp">
                    <option value="0">底部模板（请选择）</option>
                </select>
            </div>
        </div>
    </div>
</form>
    <script type="text/javascript"> hayui.use(['element', 'topservice'], function (element, topservice) { });</script>
    
<script> 
    hayui.use(['table', 'form'], function (table, form) {
        var $ = hayui.$;

        form.render();

        var table_where = ($.cookie('qpr_add_supply_return') != undefined && '0' === '1') ? 
                                eval('(' + $.cookie('qpr_add_supply_return') + ')') : 
                                {infoType:1,cpzt:'',cxsx:'',prostar:'',sqpp:'',cid:'-1_0'};
        table.render({
            method:'post',
            skin:'nob',
            elem: '[hay-filter="productSupply"]',
            url:,
            where: table_where,
            id: 'productSupply',
            page: true,
            defaultindex: ($.cookie('qpr_add_supply_return') != undefined && '0' === '1') ? $.cookie('qpr_add_supply_return_index') : 1,
            cols: [
                [{checkbox: true, fixed: true},
                {field: 'ProductPicSmall',title: '图片',width:100,align: 'center',
                    format: function (row, value) {
                        return html = ["<img height='47' width='62' alt='" + row.ProductName + "' src='" + row.ProductPicSmall + "'>"];
                    }
                },
                {field: 'ProductName',title: '标题',width: 300,align: 'left',
                    format: function (row, value) {
                        var html = ["<span>"];
                        html.push("<a href='" + ('http://www.qipeiren.com/' + "Supply/supply-" + row.Id + ".htm") + "' target='_blank'>" + value + "</a>");
                        html.push("</span>");
                        if(row.IsPass==2&&row.NoPassRe!="")
                        {
                            html.push("<br><font color=blue>未通过审核原因："+row.NoPassRe+"</font>");
                        }
                        else if(row.IsPass==3)
                        {
                            var typeInfo="";
                            if(row.ComplaintType==1){typeInfo="标题/描述/图片不符";}
                            if(row.ComplaintType==2){typeInfo="类目不符";}
                            if(row.ComplaintType==3){typeInfo="价格虚假";}
                            if(row.ComplaintType==4){typeInfo="授权品牌不符";}
                            if(row.ComplaintType==5){typeInfo="授权品牌虚假";}

                            html.push("<br><font color=red>违规下架："+typeInfo+"</font>");
                        }
                        else if(row.IsPass==4)
                        {
                            html.push("<br><font color=red>已申请重新上架，等待审核</font>");
                        }
                        return html.join("");
                    }
                },
                {field: 'kindsCount',title: '车型筛选',width: 100,align: 'center',
                    format: function (row, value) {
                        if (row.kindsCount > 0) {
                            return html = "<i class='hayui-icon hayui-icon-corret hayui-color-success'></i>";
                        }
                        else {
                            return html = "<i class='hayui-icon hayui-icon-close2 hayui-color-danger'></i>";
                        }
                    }
                },
                {field: 'ProNewClassName',title: '品类', width: 100, align: 'left',
                    format: function (row, value) {
                        return value == "" ? "<span style='color:#f00'>未分类</span>" : value;
                    }},
                {field: 'wprice',title: '价格',width: 120,align: 'center',
                    format: function (row, value) {
                        var html = ["<span>"];
                        if (row.wprice == 0) {
                            html.push("面议");
                        }
                        else {
                            html.push(row.wprice_Format);
                        }
                        html.push("</span><a class='hayui-icon hayui-icon-edit1 hayui-color-normal hayui-fs-14 hayui-ml5' hay-event='edit_wprice'></a>");
                        return html.join("");
                    }
                },
                {field: 'score',title: '质量星级',width: 100,align: 'center',
                    format: function (row, value) {
                        var b = row.ComLevel > 0 ? row.ComLevel / 20 : 0;
                        if (b > 0 && b < 1) { b = 1 }
                        if (b > 1 && b < 2) { b = 2 }
                        if (b > 2 && b < 3) { b = 3 }
                        if (b > 3 && b < 4) { b = 4 }
                        if (b > 4 && b < 5) { b = 5 }
                        var star = [];
                        for(var i = 0; i < 5; i++){
                            star.push("<i class='hayui-icon hayui-icon-collectfull hayui-fs-12 hayui-color-warm'></i>");
                        }
                        var repstr = [];
                        for(var i = 0; i < 5 - b; i++){
                            repstr.push("<i class='hayui-icon hayui-icon-collect hayui-fs-12 hayui-color-gray'></i>");
                        }
                        star.splice(b, 5 - b, repstr.join(''));
                        return star.join('');
                    }
                },
                {
                    field: 'classify',title: '操作',width: 100,align: 'center',
                    format: function (row, value) {
                        if(1==2)
                        {
                            return '<a class="hayui-link hayui-link-normal" href=/work/proaddneed?id=' + row.Id + '>修改</a><a class="hayui-link hayui-link-primary hayui-ml10" href= /work/share?flag=s&f=proid&id='+ row.Id + ' target="_blank" >分享</a>';
                        }
                        else
                        {
                            return '<a class="hayui-link hayui-link-normal" href=/work/proaddsupply?id=' + row.Id + '>修改</a><a class="hayui-link hayui-link-primary hayui-ml10" href= /work/share?flag=s&f=proid&id='+ row.Id + ' target="_blank" >分享</a>';
                        }
                    }
                }]
            ],
            done: function (res, curr, count) {
                var field = form.getAllFiles('form-search');
                field.infoType = 1;
                var cookievalue = JSON.stringify(field);
                var options = { path: "/", domain: "qipeiren.com" };
                $.cookie('qpr_add_supply_return_index', curr, options);
                $.cookie('qpr_add_supply_return', cookievalue, options);
            }
        });

        active = {
            reset:function(){
                form.reset('form-search');
            },
            dosearch: function () {
                var field = form.getAllFiles('form-search');
                table.reload('productSupply', {
                    where: field,
                    defaultindex:1
                });
            },
            batchsave:function(){
                var checkDatas = table.checkDatas('productSupply', ['Id'], 'colstr');
                var user_cid = $('[name="user_cid"]');
                var strid=checkDatas.coldata;
                form.render();
                if (checkDatas.nums) {
                    layer.open({
                        type: 1,
                        title: '追加自定义分类',
                        closeBtn: 2,
                        shadeClose: true,
                        area: ['420px', 'auto'],
                        content: $('#update_proclass_from'),
                        btn: ['确认', '取消'],
                        yes:function(index, layero){
                            $.ajax({
                                type: "post",
                                data: { strid: strid,classid:user_cid.val()},
                                url: globals.sys_applicationname +'/infolist/addsupplyclasspiliang',
                                dataType: "json",
                                async: false,
                                success: function (result) {
                                    layer.msg(result.msg);
                                    if (result.success) {
                                        layer.close(index);
                                        //table.reload('productSupply');
                                        $(".hayui-haypage-btn").click();
                                    }
                                }
                            });
                        }
                    });
                }else{
                    layer.msg('请先选择需要追加的分类数据');
                }
            },
            batchdel: function() {
                var checkDatas = table.checkDatas('productSupply', ['Id'], 'colstr');
                var strid=checkDatas.coldata;
                if (checkDatas.nums) {
                    layer.confirm('确定要删除所选中的'+ checkDatas.nums +'项吗?', {
                        icon: 3,
                        title: '提示'
                    }, function(index) {
                        $.ajax({
                            type: "post",
                            data: { strid: strid },
                            url: globals.sys_applicationname +'/infolist/deletesupplypiliang',
                            dataType: "json",
                            async: false,
                            success: function (result) {
                                layer.msg(result.msg);
                                if (result.success) {
                                    layer.close(index);
                                    //table.reload('productSupply');
                                    $(".hayui-haypage-btn").click();
                                }
                            }
                        });
                    });
                }else{
                    layer.msg('请先选择要删除的数据');
                }
            },
            batchShangJia: function() {
                var checkDatas = table.checkDatas('productSupply', ['Id'], 'colstr');
                var strid=checkDatas.coldata;
                if (checkDatas.nums) {
                    layer.confirm('确定要申请上架所选中的'+ checkDatas.nums +'项吗?', {
                        icon: 3,
                        title: '提示'
                    }, function(index) {
                        $.ajax({
                            type: "post",
                            data: { strid: strid },
                            url: globals.sys_applicationname +'/infolist/shangjiasupplypiliang',
                            dataType: "json",
                            success: function (result) {
                                layer.msg(result.msg);
                                if (result.success) {
                                    layer.close(index);
                                    //table.reload('productSupply');
                                    $(".hayui-haypage-btn").click();
                                }
                            }
                        });
                    });
                }else{
                    layer.msg('请先选择要申请上架的数据');
                }
            },
            edit_wprice: function(obj){
                var data = obj.data;
                var wprice = $('[name="wprice"]');
                var yunfei = $('[name="yunfei"]');
                wprice.val(data.wprice);
                yunfei.val(data.Tel);
                form.render('select', '', 'yunfei');

                layer.open({
                    type: 1,
                    title: '修改产品价格',
                    closeBtn: 2,
                    shadeClose: true,
                    area: ['420px', 'auto'],
                    content: $('#update_wprice_from'),
                    btn: ['确认', '取消'],
                    yes:function(index, layero){
                        if(wprice.val().length>0)
                        {
                            $.ajax({
                                type: "post",
                                data: { ProductId:data.Id,wprice: wprice.val(),yunfei:yunfei.val()},
                                url: globals.sys_applicationname +'/infolist/updatesupplywprice',
                                dataType: "json",
                                success: function (result) {
                                    layer.msg(result.msg);
                                    if (result.success) {
                                        layer.close(index);
                                        //table.reload('productSupply');
                                        $(".hayui-haypage-btn").click();
                                    }
                                }
                            });
                        }
                    }
                });
            },
            batchtemp:function(){
                var checkDatas = table.checkDatas('productSupply', ['Id'], 'colstr');
                var strid=checkDatas.coldata;
                if (checkDatas.nums) {
                    form.render('select', '', 'top_tmp');
                    form.render('select', '', 'bot_tmp');
                    layer.open({
                        type: 1,
                        title: '关联版式',
                        closeBtn: 2,
                        shadeClose: true,
                        area: ['420px', 'auto'],
                        content: $('#add_template'),
                        btn: ['确认', '取消'],
                        yes: function (index, layero) {
                            var top= $("#top_tmp").val();
                            var bot=$("#bot_tmp").val();
                            $.ajax({
                                type: "post",
                                data: { strid: strid,top_tmp:top,bot_tmp:bot },
                                url: globals.sys_applicationname + '/InfoList/UpdateTemplate',
                                dataType: "json",
                                async: false,
                                success: function (res) {
                                    if(res.success){
                                        layer.msg('关联成功');
                                    }else{
                                        layer.msg('关联失败');
                                    }
                                    layer.close(index);
                                    $(".hayui-haypage-btn").click();
                                }
                            });
                        },
                        btn2: function (index, layero) {
                            layer.close(index);
                        }
                    });
                }else{
                    layer.msg('请先选择要关联的数据');
                }
            }
        };
        table.on('tool(productSupply)', function (obj) {
            active[obj.event](obj);
        });
        $('[hay-batch="btn"]').on('click', function () {
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });
        $('[data-type="push"]').on('click', function () {
            var btn = $(this);
            if (btn.data('tag')) {
                window.location.href = globals.sys_applicationname + "/infoaddnews?infoType=29";
            }
            else {
                layer.msg("您的注册信息没有通过审核，暂时不能发布", {
                    end: function () {
                        window.location.href = globals.sys_applicationname;
                    }
                });
            }
        });
    });
</script>

</body>
</html>