
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="renderer" content="webkit|ie-stand" />
    <meta charset="utf-8" />
    <title>汽配人-我的旺铺</title>

    <link href="../../css/css_base.css" rel="stylesheet" />
    <link href="../../css/css_top.css" rel="stylesheet" />
    <link href="../../css/hayui.css" rel="stylesheet" />
    <link href="../../css/leagueradmin-nav-sidemenu.css" rel="stylesheet" />
    
    <script src="../../js/jquery-3.3.1.min.js" type="text/javascript"></script>
    <script src="../../js/jquery.cookie.js" type="text/javascript"></script>
    <script src="../../js/hayui.js" type="text/javascript"></script>
    <script type="text/javascript">
        var globals = { sys_applicationname: '/work' };
        function qpr_skip() {
            var options = { path: "/" };
            $.cookie('qpr_h_flag', '1', options);
            location.href = globals.sys_applicationname;
        }
        function mall_skip() {
            var options = { path: "/" };
            $.cookie('qpr_h_flag', '2', options);
            location.href = "http://mall.qipeiren.com/selleradmin/home";
        }
        $(function () {$("#headTopNav").load("http://www.qipeiren.com/c/TShare/HeadTopLink?headcrror=true");});
    </script>
    
</head>
<body class="hayui-bg-gray-light">

<div class="hayui-helptip hayui-bg-normal hayui-mb10">
    <div class="hayui-helptip-cont">
        <i class="helptip-tipicon hayui-icon hayui-icon-tip3 hayui-color-danger hayui-fs-20"></i>
        <label class="helptip-title">【温馨提示】</label>
        <div class="helptip-indent">
            <span class="helptip-desc">版式即商品通用描述模板，分为顶部模板和底部模板两种，关联后可显示在商品详细描述的顶部或底部</span>
        </div>
    </div>
    <div onclick="this.parentNode.style.display='none';" class="hayui-helptip-btn hayui-colse">
        <i class="hayui-icon hayui-icon-close2"></i>
    </div>
</div>
<div class="hayui-bg-white hayui-p10">
    <div class="hayui-tab hayui-tab-brief" hay-filter="tabbrand">
        <ul class="hayui-tab-title">
            <li hay-id="template">
                <a href="SellerGoodFormatManage.html">管理</a>
            </li>
            <li hay-id="submitbrand" class="hayui-this">
                <a hay-id="template">新增</a>
            </li>
        </ul>
        <div class="hayui-tab-content">
            <form class="hayui-form hayui-mt5" hay-filter="form-add">
                <input name="id" type="hidden" id="page" value="0" />
                <div class="hayui-form-item hayui-mt10">
                    <div class="hayui-inline">
                        <label class="hayui-form-label"><i class="hayui-icon hayui-icon-snowflake1 hayui-fs-12 hayui-color-danger"></i>名称：</label>
                        <div class="hayui-input-block">
                            <input type="text" name="name" id="name"  hay-verify="required|title" autocomplete="off" placeholder="请输入标题" class="hayui-input hayui-w250">
                        </div>
                    </div>
                </div>

                <div class="hayui-form-item hayui-mt10">
                    <div class="hayui-inline">
                        <label class="hayui-form-label"><i class="hayui-icon hayui-icon-snowflake1 hayui-fs-12 hayui-color-danger"></i>版式位置：</label>
                        <div class="hayui-input-inline " hay-verify="radios" hay-verify-range="[1,1]" hay-verify-tips="请选择您模板的位置">

                            <input type="radio" name="position" value="1" title="顶部" checked >

                            <input type="radio" name="position" value="2" title="底部"  >
                        </div>
                    </div>
                </div>

                <!--详细说明-->
                <div class="hayui-form-item hayui-mt10" id="a_pro_content">
                    <label class="hayui-form-label"><i class="hayui-icon hayui-icon-snowflake1 hayui-fs-12 hayui-color-danger"></i>详细说明</label>
                    <div class="hayui-input-inline">
                        <span class="hayui-btn hayui-btn-normal hayui-btn-mini" isselresultmoban="true">产品描述模板</span>
                        <label class="hayui-word-aux">您可以选择使用模板来编辑详细说明</label>
                        <span class="b_err_tips hayui-color-danger" id="js_ueditor_Tip"></span>
                    </div>
                </div>
                <div class="hayui-form-item hayui-mt10">
                    <label class="hayui-form-label"></label>
                    <div class="hayui-input-inline" hay-verify="js_ueditor">
                        <textarea id="js_ueditor" name="js_ueditor" maxlength="10000" style="width:802px; height:320px;"></textarea>
                    </div>
                </div>
            </form>
            <div class="hayui-form-item">
                <label class="hayui-form-label hayui-w100"></label>
                <div class="hayui-inline hayui-text-align-l hayui-mt10">
                    <button class="hayui-btn hayui-btn-normal hayui-btn-small" id="btnok">确认</button>
                </div>
            </div>
        </div>
    </div>
</div>

    <script type="text/javascript"> hayui.use(['element', 'topservice'], function (element, topservice) { });</script>
    
    <!-- 编辑器配置文件/源码文件 -->
    <script type="text/javascript" src="../../js/javascripts/lib/ueditor/ueditor.config.js"></script>
    <script type="text/javascript" src="../../js/javascripts/lib/ueditor/ueditor.all.js"></script>
    <script src="http://img.qipeiren.com/Site/Web/javascripts/jQuery.pop.floor.js"></script>
    <script>var iframeUrl = 'http://work.qipeiren.com/User/upload/KEditorChooseImage';</script>
    <script type="text/javascript" src="../../js/javascripts/lib/ueditor/dialogs/cloudimage/cloudimage.js"></script>
    <script type="text/javascript">
        document.domain = 'qipeiren.com';
        hayui.use(['layer', 'form'], function (layer, form) {
            var $ = hayui.$;
            form.render();
            $(function () {
                $('[isBtn="true"]', $('[isSelResult="true"]')).on('click', function () {
                    var t = $(this);
                    layer.open({
                        type: 2,
                        title: '插入图片',
                        area: ['755px', '500px'],
                        closeBtn: 2,
                        shadeClose: true,
                        id: 'insertProImageFrame',
                        content: ['http://work.qipeiren.com/User/upload/chooseImage', 'no'],
                        success: function (layero, index) {
                            var tp = t.parents('[isSelResult="true"]');
                            var totalNum = $('[isResItem="true"]', tp).length;
                            var curNum = $('[isResItem="true"][isEmpty="false"]', tp).length;
                            var totalCanNum = totalNum - curNum;

                            var body = layer.getChildFrame('body', index);
                            var curNumO = $('#js_curNum', body);
                            var totalNumO = $('#js_totalNum', body);
                            var resultO = $('[isSelResult="true"]', body);
                            curNumO.text(0);
                            totalNumO.text(totalCanNum);
                            totalCanNum > 0 ? $('[isResItem="true"]:gt(' + (totalCanNum - 1) + ')', resultO).remove() : '';
                        }
                    });
                });
                $('[isSelResult="true"]').each(function (index, el) {
                    var resBox = $(el);
                    var del = $('[isDel="true"]', resBox);
                    del.on({
                        click: function () {
                            var item = $(this).parents('[isResItem="true"]');
                            var btnBox = $('[isBtn="true"]', item);
                            var imgBox = $('[isImg="true"]', item);
                            var img = $('img', imgBox);
                            var inpt = $('[isInpt="true"]', item);
                            img.attr({
                                src: ''
                            });
                            inpt.val('');
                            item.attr({
                                isEmpty: true
                            });
                            imgBox.addClass('hide').hide();
                            btnBox.removeClass('hide').show();
                        }
                    })
                });
                form.verify({
                    title: function (value) {
                        var len = form.getStrLength(value);
                        if (len < 3 || len > 80) { return "请输入3-40个字！"; }
                    },
                    js_ueditor: function (value) {
                        var cont = '';
                        var conthtml = '';
                        ue.ready(function () {
                            cont = ue.getContentTxt();
                            conthtml = ue.getContent();
                        });

                        if (cont.length < 1 && $(conthtml).find('img').length < 1) { return '模板内容不能为空'; }
                    }
                });

                ///确认提交
                $("#btnok").on('click', function () {
                    var btn = $(this);
                    var verify = form.doAllverify('form-add', true);

                    if (!verify && !btn.hasClass('hayui-btn-disabled')) {
                        var sava_params = {};
                        var field = form.getAllFiles('form-add');
                        sava_params.id = field.id;
                        sava_params.name = field.name;
                        sava_params.position = field.position;
                        sava_params.Content = field.js_ueditor;
                        btn.addClass('hayui-btn-disabled');
                        btn.html('提交中...');

                        $.ajax({
                            type: 'post',
                            url: globals.sys_applicationname + '/infotemplate/edit',
                            data: { model_json: encodeURIComponent(JSON.stringify(sava_params)) },
                            dataType: "json",
                            success: function (result) {
                                if (result.success) {
                                    layer.msg(result.msg);
                                    window.location.href = globals.sys_applicationname + "/infotemplate";
                                }
                                else {
                                    layer.msg(result.msg);
                                }
                            }
                        });
                    }
                })
            });
        });

        var ue = UE.getEditor('js_ueditor', {
            serverUrl: globals.sys_applicationname + '/UEditor/Handle',
            initialFrameWidth: 800,
            initialFrameHeight: 320,
            toolbars: [
                ["undo", "redo", "fontsize", "bold", "forecolor", "backcolor", "justifyleft", "justifycenter", "justifyright", "inserttable", "insertorderedlist", "insertunorderedlist", "removeformat", "source", "fullscreen"]
            ],
            scaleEnabled: true,
            autoHeightEnabled: true,
            autoFloatEnabled: false,
            imageScaleEnabled: false,
            customDomain: true
        });

        // 设置编辑器内容，用于模板弹框
        var setUeTempleteCont = function (cont) {
            ue.setContent(cont);
            ue.focus(true);
        };
        // 详细说明模板弹框
        $('[isselresultMoBan="true"]').on('click', function () {
            layer.open({
                type: 2,
                title: '我的模板',
                area: ['795px', '500px'],
                closeBtn: 2,
                shadeClose: true,
                id: 'selCarTypeFrame',
                content: ['http://mall.qipeiren.com/ShopAndB2BInfo/ShopTemplate', 'no']
            });
        });

    </script>

</body>
</html>